import e from"vue";const t=[{type:String,default:"",parse:e=>e,serialize:e=>e},{type:Number,default:null,parse:e=>parseInt(e,10),serialize:e=>e+""},{type:Boolean,default:!1,parse:e=>"1"===e,serialize:e=>e+0+""},{type:Array,default:()=>[],parse:e=>e&&"["===e[0]&&JSON.parse(e)||[],serialize:e=>JSON.stringify(e)},{type:Object,default:()=>{},parse:e=>e&&"{"===e[0]&&JSON.parse(e)||{},serialize:e=>JSON.stringify(e),deep:!0},{type:Date,default:()=>null,parse:e=>0===e.trim().length?null:Date.parse(e),serialize:e=>null==e?"":e.toISOString()}];const n=new e({});function r(e,r,s=localStorage){Array.isArray(r)&&(r=r.reduce(((e,t)=>Object.assign(e,{[t]:{default:null}})),{}));const a=Object.keys(r);a.forEach((e=>{const n=r[e];r[e]=function(e){let n;return null!=(n=t.find((t=>t.type===e)))?n:null!=(n=t.find((t=>t.type===e.type)))?Object.assign({},n,e):e}(n)}));const l=function(t){return(e?e+".":"")+(r[t].as||t)},i=function(e){const t=r[e],n=l(e);let a=s.getItem(n);return null==a&&(a="function"==typeof t.default?r.default():r.default),t.parse?t.parse(a):a},o=function(e){const t=r[e],a=l(e);return function(e){if(null==e)return;const r=t.serialize?t.serialize(e):e;s.setItem(a,r),n.$emit(a,e)}},u={},f={};let c=null;return{data(){const e={};for(const t of a)e[t]=i(t);return e},created(){for(const e of a){const t=r[e],s=l(e),a=t.type===Array?t=>this[e].splice(0,this[e].length,...t):t=>this[e]=t;!1!==t.readonly&&this.$watch(e,{handler:o(e),deep:t.deep||!1}),u[e]=t=>{this[e]!==t&&a(t)},f[s]=n=>{const r=t.parse(n.newValue);this[e]!==r&&a(r)},n.$on(s,u[e])}c=e=>{f[e.key]&&f[e.key](e)},window.addEventListener("storage",c)},destroyed(){c&&window.removeEventListener("storage",c);for(const e of a)n.$off(l(e),u[e])}}}export default r;
