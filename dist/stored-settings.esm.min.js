import e from"vue";const t=[{type:String,default:"",parse:e=>e,serialize:e=>e},{type:Number,default:null,parse:e=>parseInt(e,10),serialize:e=>e+""},{type:Boolean,default:!1,parse:e=>"1"===e,serialize:e=>e+0+""},{type:Array,default:()=>[],parse:e=>e&&"["===e[0]&&JSON.parse(e)||[],serialize:e=>JSON.stringify(e)},{type:Object,default:()=>{},parse:e=>e&&"{"===e[0]&&JSON.parse(e)||{},serialize:e=>JSON.stringify(e),deep:!0},{type:Date,default:()=>null,parse:e=>0===e.trim().length?null:Date.parse(e),serialize:e=>null==e?"":e.toISOString()}];const r=new e({});function n(e,n,s=localStorage){Array.isArray(n)&&(n=n.reduce(((e,t)=>Object.assign(e,{[t]:{default:null}})),{}));const i=Object.keys(n);i.forEach((e=>{const r=n[e];n[e]=function(e){let r;if(null!=(r=t.find((t=>t.type===e))))return r;if(null!=(r=t.find((t=>t.type===e.type))))return Object.assign({},r,e);if(null!==(r=e.type)&&"parse"in r&&"serialize"in r)return console.debug("Using custom type",r),Object.assign({},r,e);if(null!==(r=e.type)&&"parse"in r&&"toJSON"in r.prototype)return console.debug("Using custom type with toJSON serializer",r),Object.assign({},r,{serialize:e=>JSON.stringify(e)},e);if("parse"in e&&"serialize"in e)return e;throw new Error("Custom type must provide 'parse' and 'serialize' static methods")}(r)}));const a=function(t){return(e?e+".":"")+(n[t].as||t)},l=function(e){const t=n[e],r=a(e);let i=s.getItem(r);return null==i&&(i="function"==typeof t.default?t.default():t.default),t.parse?t.parse(i):i},o=function(e){const t=n[e],i=a(e);return function(e){if(null==e)return;const n=t.serialize?t.serialize(e):e;s.setItem(i,n),r.$emit(i,e)}},u={},p={};let f=null;return{data(){const e={};for(const t of i)e[t]=l(t);return e},created(){for(const e of i){const t=n[e],s=a(e),i=t.type===Array?t=>this[e].splice(0,this[e].length,...t):t=>this[e]=t;!1!==t.readonly&&this.$watch(e,{handler:o(e),deep:t.deep||!1}),u[e]=t=>{this[e]!==t&&i(t)},p[s]=r=>{const n=t.parse(r.newValue);this[e]!==n&&i(n)},r.$on(s,u[e])}f=e=>{p[e.key]&&p[e.key](e)},window.addEventListener("storage",f)},destroyed(){f&&window.removeEventListener("storage",f);for(const e of i)r.$off(a(e),u[e])}}}export default n;
